<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .connected { background: #d4edda; color: #155724; }
        .disconnected { background: #f8d7da; color: #721c24; }
        .error { background: #fff3cd; color: #856404; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        input { padding: 8px; margin: 5px; width: 300px; }
        #messages { height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>WebSocket Connection Test</h1>
    
    <div>
        <label for="wsUrl">WebSocket URL:</label><br>
        <input type="text" id="wsUrl" value="ws://localhost:8080" placeholder="ws://localhost:8080">
        <button onclick="connect()">–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è</button>
        <button onclick="disconnect()">–í—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è</button>
    </div>
    
    <div id="status" class="status disconnected">–í—ñ–¥–∫–ª—é—á–µ–Ω–æ</div>
    
    <div>
        <input type="text" id="message" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è">
        <button onclick="sendMessage()">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
    </div>
    
    <div id="messages"></div>
    
    <script>
        let ws = null;
        const statusDiv = document.getElementById('status');
        const messagesDiv = document.getElementById('messages');
        
        function updateStatus(message, className) {
            statusDiv.textContent = message;
            statusDiv.className = `status ${className}`;
        }
        
        function addMessage(message, type = 'info') {
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            div.style.color = type === 'error' ? 'red' : type === 'sent' ? 'blue' : 'green';
            messagesDiv.appendChild(div);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        function connect() {
            const url = document.getElementById('wsUrl').value;
            if (!url) {
                alert('–í–≤–µ–¥—ñ—Ç—å WebSocket URL');
                return;
            }
            
            try {
                ws = new WebSocket(url);
                
                ws.onopen = function() {
                    updateStatus('–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ', 'connected');
                    addMessage('‚úÖ –ó\'—î–¥–Ω–∞–Ω–Ω—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                };
                
                ws.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        addMessage(`üì® –û—Ç—Ä–∏–º–∞–Ω–æ: ${JSON.stringify(data)}`);
                    } catch (e) {
                        addMessage(`üì® –û—Ç—Ä–∏–º–∞–Ω–æ: ${event.data}`);
                    }
                };
                
                ws.onclose = function() {
                    updateStatus('–í—ñ–¥–∫–ª—é—á–µ–Ω–æ', 'disconnected');
                    addMessage('‚ùå –ó\'—î–¥–Ω–∞–Ω–Ω—è –∑–∞–∫—Ä–∏—Ç–æ');
                    ws = null;
                };
                
                ws.onerror = function(error) {
                    updateStatus('–ü–æ–º–∏–ª–∫–∞ –∑\'—î–¥–Ω–∞–Ω–Ω—è', 'error');
                    addMessage(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error}`, 'error');
                };
                
            } catch (error) {
                updateStatus('–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', 'error');
                addMessage(`‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è: ${error}`, 'error');
            }
        }
        
        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
            }
        }
        
        function sendMessage() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                alert('–°–ø–æ—á–∞—Ç–∫—É –ø—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ WebSocket');
                return;
            }
            
            const message = document.getElementById('message').value;
            if (!message.trim()) {
                alert('–í–≤–µ–¥—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è');
                return;
            }
            
            const data = {
                type: 'message',
                content: message,
                timestamp: new Date().toISOString()
            };
            
            ws.send(JSON.stringify(data));
            addMessage(`üì§ –ù–∞–¥—ñ—Å–ª–∞–Ω–æ: ${JSON.stringify(data)}`, 'sent');
            document.getElementById('message').value = '';
        }
        
        // –ê–≤—Ç–æ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø—Ä–∏ Enter
        document.getElementById('message').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ä—ñ–∑–Ω–∏—Ö URL
        function testUrls() {
            const urls = [
                'ws://localhost:8080',
                'wss://echo.websocket.org',
                'wss://ws.postman-echo.com/raw'
            ];
            
            urls.forEach(url => {
                addMessage(`üîó –¢–µ—Å—Ç URL: ${url}`);
            });
        }
        
        // –ó–∞–ø—É—Å–∫–∞—î–º–æ —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.onload = function() {
            addMessage('üöÄ –¢–µ—Å—Ç–æ–≤–∏–π –∫–ª—ñ—î–Ω—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ');
            addMessage('üí° –ü—ñ–¥–∫–∞–∑–∫–∞: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ wss://echo.websocket.org –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è');
        };
    </script>
</body>
</html>
